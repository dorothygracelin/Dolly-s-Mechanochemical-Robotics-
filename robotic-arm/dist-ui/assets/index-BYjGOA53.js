const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./three-examples-QM4Fg4BM.js","./three-vendor-BMEV5b5r.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const ee="modulepreload",te=function(t,e){return new URL(t,e).href},$={},_=function(e,i,o){let n=Promise.resolve();if(i&&i.length>0){const r=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=Promise.allSettled(i.map(f=>{if(f=te(f,o),f in $)return;$[f]=!0;const m=f.endsWith(".css"),v=m?'[rel="stylesheet"]':"";if(!!o)for(let b=r.length-1;b>=0;b--){const I=r[b];if(I.href===f&&(!m||I.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${v}`))return;const y=document.createElement("link");if(y.rel=m?"stylesheet":ee,m||(y.as="script"),y.crossOrigin="",y.href=f,u&&y.setAttribute("nonce",u),document.head.appendChild(y),m)return new Promise((b,I)=>{y.addEventListener("load",b),y.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${f}`)))})}))}function s(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return n.then(r=>{for(const l of r||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},z=1e-9;function k(t){return Math.hypot(t[0],t[1])}function F(t,e){return[t[0]-e[0],t[1]-e[1]]}function ne(t,e){return t[0]*e[0]+t[1]*e[1]}function oe(t,e){return t[0]*e[1]-t[1]*e[0]}function ie(t,e){const i=k(t),o=k(e);if(i<z||o<z)return 0;let n=ne(t,e)/(i*o);n=Math.max(-1,Math.min(1,n));const s=oe(t,e);let r=Math.acos(n);return s<0?-r:r}class se{constructor(e){if(!Array.isArray(e)||e.length===0)throw new Error("lengths must be a non-empty array");this.lengths=e.slice(),this.n=this.lengths.length,this.angles=new Array(this.n).fill(0),this.jointPositions=[],this.origin=[0,0]}setAngles(e){if(!Array.isArray(e)||e.length!==this.n)throw new Error("angles length mismatch");return this.angles=e.slice(),this.forwardKinematics()}forwardKinematics(){let e=this.origin.slice();this.jointPositions=[e.slice()];let i=0;for(let o=0;o<this.n;o++){i+=this.angles[o];const n=this.lengths[o]*Math.cos(i),s=this.lengths[o]*Math.sin(i);e=[e[0]+n,e[1]+s],this.jointPositions.push(e.slice())}return this.jointPositions}getEndEffector(){return this.jointPositions.length===0&&this.forwardKinematics(),this.jointPositions[this.jointPositions.length-1]}distanceTo(e){const i=this.getEndEffector();return k(F(e,i))}solveIK_CCD(e,{maxIterations:i=100,tolerance:o=.001,earlyExit:n=!0,damping:s=1}={}){if(!Array.isArray(e)||e.length!==2)throw new Error("target must be [x,y]");this.forwardKinematics();let r=[];arguments[1]&&Array.isArray(arguments[1].jointMasses)&&(r=arguments[1].jointMasses);const l=arguments[1]&&typeof arguments[1].massFactor=="number"?arguments[1].massFactor:.5;for(let u=0;u<i;u++){for(let m=this.n-1;m>=0;m--){const v=this.jointPositions[m],j=this.getEndEffector(),y=F(j,v),b=F(e,v),I=ie(y,b);let K=0;Array.isArray(r)&&typeof r[m]=="number"&&(K=r[m]);const Q=1/(1+l*K);this.angles[m]+=I*s*Q,this.forwardKinematics()}const f=this.distanceTo(e);if(n&&f<=o)return{success:!0,iterations:u+1,distance:f}}return{success:!1,iterations:i,distance:this.distanceTo(e)}}}const g=typeof globalThis<"u"&&globalThis.document?globalThis.document:{getElementById:()=>null,createElement:()=>({}),body:{}},d=typeof globalThis<"u"&&globalThis.window?globalThis.window:typeof globalThis<"u"?globalThis:{addEventListener:()=>{},innerWidth:1e3,innerHeight:800,requestAnimationFrame:t=>globalThis&&globalThis.setTimeout?globalThis.setTimeout(t,16):0,cancelAnimationFrame:t=>globalThis&&globalThis.clearTimeout?globalThis.clearTimeout(t):void 0,URL:{createObjectURL:()=>""},webkitURL:{createObjectURL:()=>""}},h=g.getElementById("canvas"),c=h?h.getContext("2d"):null,re=g.getElementById("autoSolve"),ae=g.getElementById("maxIter"),ce=g.getElementById("tol"),x=g.getElementById("jointSelect"),R=g.getElementById("componentSelect"),V=g.getElementById("attachBtn"),W=g.getElementById("detachBtn"),le=g.getElementById("info"),q=g.getElementById("massRow"),fe=g.getElementById("massInput"),X=g.getElementById("assetInput"),B=g.getElementById("previewName"),S=g.getElementById("previewImage"),E=g.getElementById("modelCanvas"),C=typeof console<"u"?console:{log:()=>{},warn:()=>{},error:()=>{},info:()=>{}};let L=null,w=null;const de={counterweight:{type:"model",url:"./assets/counterweight.obj",name:"counterweight.obj"}};let a=null;async function N(){if(w)return w.__THREE__;if(!E)return null;const e=await _(()=>import("./three-vendor-BMEV5b5r.js"),[],import.meta.url);return w=new e.WebGLRenderer({canvas:E,antialias:!0,alpha:!0}),w.setSize(E.width,E.height),w.outputEncoding=e.sRGBEncoding,w.toneMapping=e.ACESFilmicToneMapping,w.toneMappingExposure=1,w.__THREE__=e,e}function Y(t,e){t.traverse(i=>{i.isMesh&&(i.material=new e.MeshStandardMaterial({color:11978710,metalness:.96,roughness:.22,emissive:4130,emissiveIntensity:.02}),i.castShadow=!0,i.receiveShadow=!0)})}function M(t,e,i){const o=new i.Box3().setFromObject(t),n=o.getSize(new i.Vector3),s=o.getCenter(new i.Vector3),r=Math.max(n.x,n.y,n.z),l=e.fov*(Math.PI/180);let u=Math.abs(r/2/Math.tan(l/2))*1.6;u<1&&(u=1),e.position.set(s.x,s.y+r*.1,s.z+u),e.lookAt(s.x,s.y,s.z)}function J(t){const e=new t.Scene;e.background=new t.Color(725536);const i=new t.HemisphereLight(16777215,2236996,.6);e.add(i);const o=new t.DirectionalLight(16777215,.9);o.position.set(5,10,7),e.add(o);const n=new t.PointLight(11202815,.6);return n.position.set(-3,-2,3),e.add(n),e}function O(t){if(a&&w){let s=function(){n&&!a.controls&&(n.rotation.y+=.008),a.controls&&typeof a.controls.update=="function"&&a.controls.update(),e.render(i,o),a.raf=d.requestAnimationFrame(s)};const e=w,i=a.scene,o=a.camera,n=a.modelGroup;a.raf&&d.cancelAnimationFrame(a.raf),s()}}const p=new se([140,100,70]);p.setAngles([0,0,0]);let T=p.getEndEffector().slice(),G=!1,U=null,P=[];function ue(){if(x){x.innerHTML="";for(let t=0;t<=p.n-1;t++){const e=g.createElement("option");e.value=t,e.textContent=`Joint ${t} (index ${t})`,x.appendChild(e)}}}ue();function A(t){const i=h.height/2;return[200+t[0],i-t[1]]}function D(t){const i=h.height/2;return[t[0]-200,i-t[1]]}h&&h.addEventListener("mousedown",t=>{G=!0,U=[t.offsetX,t.offsetY],T=D(U)});d&&d.addEventListener&&(d.addEventListener("mousemove",t=>{if(!G)return;const e=h.getBoundingClientRect(),i=[t.clientX-e.left,t.clientY-e.top];U=i,T=D(i)}),d.addEventListener("mouseup",()=>{G=!1}));V&&V.addEventListener("click",()=>{const t=parseInt(x.value,10),e=R.value;if(!P.find(i=>i.jointIndex===t)){const i={jointIndex:t,type:e};e==="counterweight"&&(i.mass=parseFloat(fe.value)||0),L&&(i.asset=L),P.push(i)}});W&&W.addEventListener("click",()=>{const t=parseInt(x.value,10);P=P.filter(e=>e.jointIndex!==t)});function Z(){if(c.clearRect(0,0,h.width,h.height),re.checked){const o=new Array(p.n).fill(0);for(const n of P)n.type==="counterweight"&&typeof n.mass=="number"&&n.jointIndex>=0&&n.jointIndex<o.length&&(o[n.jointIndex]+=n.mass);p.solveIK_CCD(T,{maxIterations:parseInt(ae.value,10),tolerance:parseFloat(ce.value),damping:1,jointMasses:o,massFactor:.8})}p.forwardKinematics();const t=p.jointPositions,e=A(T);c.fillStyle="rgba(220,20,60,0.9)",c.beginPath(),c.arc(e[0],e[1],6,0,Math.PI*2),c.fill(),c.lineWidth=6;for(let o=0;o<p.n;o++){const n=A(t[o]),s=A(t[o+1]);c.strokeStyle="#2b6",c.beginPath(),c.moveTo(n[0],n[1]),c.lineTo(s[0],s[1]),c.stroke()}for(let o=0;o<t.length;o++){const n=A(t[o]);c.fillStyle="#333",c.beginPath(),c.arc(n[0],n[1],8,0,Math.PI*2),c.fill(),c.fillStyle="#fff",c.beginPath(),c.arc(n[0],n[1],4,0,Math.PI*2),c.fill()}for(const o of P){const n=t[o.jointIndex],s=A(n);c.save(),c.translate(s[0],s[1]),c.rotate(0),c.fillStyle=o.type==="camera"?"#0af":o.type==="gripper"?"#fa0":"#8a2be2",c.fillRect(-12,-30,24,16),c.fillStyle="#111",c.font="10px sans-serif",c.textAlign="center",c.fillText(o.type,0,-18),c.restore()}const i=p.getEndEffector();le.innerHTML=`Target: ${T.map(o=>o.toFixed(1)).join(", ")}<br>End effector: ${i.map(o=>o.toFixed(1)).join(", ")}<br>Distance: ${p.distanceTo(T).toFixed(2)}`,d.requestAnimationFrame(Z)}function H(){d?(h.width=Math.min((d.innerWidth||1e3)-320,1e3),h.height=Math.min((d.innerHeight||800)-120,800)):(h.width=1e3,h.height=800)}d&&d.addEventListener&&(d.addEventListener("resize",()=>{H()}),H(),d.requestAnimationFrame(Z));h&&h.addEventListener("dblclick",t=>{const e=h.getBoundingClientRect(),i=[t.clientX-e.left,t.clientY-e.top],o=D(i);p.forwardKinematics();let n={idx:0,d:1/0};for(let s=0;s<p.jointPositions.length;s++){const r=p.jointPositions[s],l=Math.hypot(r[0]-o[0],r[1]-o[1]);l<n.d&&(n={idx:s,d:l})}x.value=n.idx});R&&R.addEventListener("change",()=>{R.value==="counterweight"?q.style.display="":q.style.display="none"});X&&X.addEventListener("change",async t=>{const e=t.target.files&&t.target.files[0];if(!e)return;const i=(d.URL||d.webkitURL)&&(d.URL||d.webkitURL).createObjectURL?(d.URL||d.webkitURL).createObjectURL(e):"";if(L={file:e,url:i},B.textContent=e.name,e.type.startsWith("image/")){S.src=i,S.style.display="",E.style.display="none",L.type="image";return}if(e.name.match(/\.gltf$|\.glb$/i)){L.type="model",S.style.display="none",E.style.display="";try{const o=await N();if(!o)throw new Error("Three initialization failed");const{GLTFLoader:n}=await _(async()=>{const{GLTFLoader:u}=await import("./three-examples-QM4Fg4BM.js").then(f=>f.G);return{GLTFLoader:u}},__vite__mapDeps([0,1]),import.meta.url),s=J(o),r=new o.PerspectiveCamera(45,E.width/E.height,.1,1e3);new n().parse(await e.arrayBuffer(),"",u=>{const f=u.scene;Y(f,o),a&&(a.controls&&typeof a.controls.dispose=="function"&&a.controls.dispose(),a.scene&&a.modelGroup&&a.scene.remove(a.modelGroup),a.raf&&d.cancelAnimationFrame(a.raf)),s.add(f),(async()=>{try{const{OrbitControls:m}=await _(async()=>{const{OrbitControls:j}=await import("./three-examples-QM4Fg4BM.js").then(y=>y.O);return{OrbitControls:j}},__vite__mapDeps([0,1]),import.meta.url),v=new m(r,w.domElement);v.enableDamping=!0,v.dampingFactor=.06,v.enablePan=!0,v.autoRotate=!1,a={scene:s,camera:r,modelGroup:f,controls:v},M(f,r,o),O()}catch{a={scene:s,camera:r,modelGroup:f},M(f,r,o),O()}})()},u=>{C.warn("gltf load err",u)})}catch(o){C.error("three load failed",o),L=null}}});B&&B.addEventListener("dblclick",async()=>{const t=de.counterweight;if(t){L={type:t.type,url:t.url,file:null,name:t.name},B.textContent=t.name+" (built-in)",S.style.display="none",E.style.display="";try{const e=await N();if(!e)throw new Error("Three initialization failed");const{OBJLoader:i}=await _(async()=>{const{OBJLoader:r}=await import("./three-examples-QM4Fg4BM.js").then(l=>l.a);return{OBJLoader:r}},__vite__mapDeps([0,1]),import.meta.url),o=J(e),n=new e.PerspectiveCamera(45,E.width/E.height,.1,1e3);new i().load(t.url,r=>{Y(r,e),a&&(a.controls&&typeof a.controls.dispose=="function"&&a.controls.dispose(),a.scene&&a.modelGroup&&a.scene.remove(a.modelGroup),a.raf&&d.cancelAnimationFrame(a.raf)),o.add(r),(async()=>{try{const{OrbitControls:l}=await _(async()=>{const{OrbitControls:f}=await import("./three-examples-QM4Fg4BM.js").then(m=>m.O);return{OrbitControls:f}},__vite__mapDeps([0,1]),import.meta.url),u=new l(n,w.domElement);u.enableDamping=!0,u.dampingFactor=.06,a={scene:o,camera:n,modelGroup:r,controls:u},M(r,n,e),O()}catch{a={scene:o,camera:n,modelGroup:r},M(r,n,e),O()}})()},void 0,r=>{C.error("obj load err",r)})}catch(e){C.error("obj preview failed",e)}}});
