import{TrianglesDrawMode as It,TriangleFanDrawMode as be,TriangleStripDrawMode as ot,Loader as rt,LoaderUtils as Ee,FileLoader as Me,MeshPhysicalMaterial as K,Vector2 as P,Color as B,SRGBColorSpace as te,SpotLight as Ot,PointLight as Pt,DirectionalLight as Ct,Matrix4 as ae,Vector3 as M,InstancedMesh as Dt,Quaternion as ce,Object3D as at,TextureLoader as jt,ImageBitmapLoader as Ft,BufferAttribute as de,InterleavedBuffer as kt,LinearMipmapLinearFilter as ct,NearestMipmapLinearFilter as vt,LinearMipmapNearestFilter as Ht,NearestMipmapNearestFilter as Ut,LinearFilter as lt,NearestFilter as Gt,RepeatWrapping as ye,MirroredRepeatWrapping as Bt,ClampToEdgeWrapping as Kt,PointsMaterial as J,Material as ee,LineBasicMaterial as ie,MeshStandardMaterial as ut,DoubleSide as Vt,MeshBasicMaterial as $,PropertyBinding as zt,BufferGeometry as xe,SkinnedMesh as Xt,Mesh as Re,LineSegments as Le,Line as Yt,LineLoop as qt,Points as oe,Group as re,PerspectiveCamera as Wt,MathUtils as Zt,OrthographicCamera as Qt,Skeleton as Jt,AnimationClip as $t,Bone as en,InterpolateDiscrete as tn,InterpolateLinear as ht,InterleavedBufferAttribute as nn,Texture as Ve,VectorKeyframeTrack as sn,NumberKeyframeTrack as ze,QuaternionKeyframeTrack as Xe,FrontSide as on,Interpolant as rn,Box3 as an,Sphere as cn,EventDispatcher as ln,MOUSE as X,TOUCH as Y,Spherical as Ye,Float32BufferAttribute as q,MeshPhongMaterial as un}from"./three-vendor-BMEV5b5r.js";function qe(d,s){if(s===It)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),d;if(s===be||s===ot){let t=d.getIndex();if(t===null){const o=[],a=d.getAttribute("position");if(a!==void 0){for(let r=0;r<a.count;r++)o.push(r);d.setIndex(o),t=d.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),d}const e=t.count-2,n=[];if(s===be)for(let o=1;o<=e;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<e;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==e&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=d.clone();return i.setIndex(n),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",s),d}class hn extends rt{constructor(s){super(s),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new gn(t)}),this.register(function(t){return new Ln(t)}),this.register(function(t){return new _n(t)}),this.register(function(t){return new wn(t)}),this.register(function(t){return new Tn(t)}),this.register(function(t){return new bn(t)}),this.register(function(t){return new En(t)}),this.register(function(t){return new yn(t)}),this.register(function(t){return new mn(t)}),this.register(function(t){return new xn(t)}),this.register(function(t){return new An(t)}),this.register(function(t){return new Rn(t)}),this.register(function(t){return new dn(t)}),this.register(function(t){return new Mn(t)}),this.register(function(t){return new Sn(t)})}load(s,t,e,n){const i=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=Ee.extractUrlBase(s),this.manager.itemStart(s);const a=function(c){n?n(c):console.error(c),i.manager.itemError(s),i.manager.itemEnd(s)},r=new Me(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(s,function(c){try{i.parse(c,o,function(u){t(u),i.manager.itemEnd(s)},a)}catch(u){a(u)}},e,a)}setDRACOLoader(s){return this.dracoLoader=s,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(s){return this.ktx2Loader=s,this}setMeshoptDecoder(s){return this.meshoptDecoder=s,this}register(s){return this.pluginCallbacks.indexOf(s)===-1&&this.pluginCallbacks.push(s),this}unregister(s){return this.pluginCallbacks.indexOf(s)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(s),1),this}parse(s,t,e,n){let i;const o={},a={},r=new TextDecoder;if(typeof s=="string")i=JSON.parse(s);else if(s instanceof ArrayBuffer)if(r.decode(new Uint8Array(s,0,4))===ft){try{o[L.KHR_BINARY_GLTF]=new Nn(s)}catch(l){n&&n(l);return}i=JSON.parse(o[L.KHR_BINARY_GLTF].content)}else i=JSON.parse(r.decode(s));else i=s;if(i.asset===void 0||i.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Bn(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const l=this.pluginCallbacks[u](c);a[l.name]=l,o[l.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){const l=i.extensionsUsed[u],f=i.extensionsRequired||[];switch(l){case L.KHR_MATERIALS_UNLIT:o[l]=new pn;break;case L.KHR_DRACO_MESH_COMPRESSION:o[l]=new In(i,this.dracoLoader);break;case L.KHR_TEXTURE_TRANSFORM:o[l]=new On;break;case L.KHR_MESH_QUANTIZATION:o[l]=new Pn;break;default:f.indexOf(l)>=0&&a[l]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(e,n)}parseAsync(s,t){const e=this;return new Promise(function(n,i){e.parse(s,t,n,i)})}}function fn(){let d={};return{get:function(s){return d[s]},add:function(s,t){d[s]=t},remove:function(s){delete d[s]},removeAll:function(){d={}}}}const L={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class dn{constructor(s){this.parser=s,this.name=L.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const s=this.parser,t=this.parser.json.nodes||[];for(let e=0,n=t.length;e<n;e++){const i=t[e];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&s._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(s){const t=this.parser,e="light:"+s;let n=t.cache.get(e);if(n)return n;const i=t.json,r=((i.extensions&&i.extensions[this.name]||{}).lights||[])[s];let c;const u=new B(16777215);r.color!==void 0&&u.fromArray(r.color);const l=r.range!==void 0?r.range:0;switch(r.type){case"directional":c=new Ct(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Pt(u),c.distance=l;break;case"spot":c=new Ot(u),c.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,c.angle=r.spot.outerConeAngle,c.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return c.position.set(0,0,0),c.decay=2,G(c,r),r.intensity!==void 0&&(c.intensity=r.intensity),c.name=t.createUniqueName(r.name||"light_"+s),n=Promise.resolve(c),t.cache.add(e,n),n}getDependency(s,t){if(s==="light")return this._loadLight(t)}createNodeAttachment(s){const t=this,e=this.parser,i=e.json.nodes[s],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(r){return e._getNodeRef(t.cache,a,r)})}}class pn{constructor(){this.name=L.KHR_MATERIALS_UNLIT}getMaterialType(){return $}extendParams(s,t,e){const n=[];s.color=new B(1,1,1),s.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;s.color.fromArray(o),s.opacity=o[3]}i.baseColorTexture!==void 0&&n.push(e.assignTexture(s,"map",i.baseColorTexture,te))}return Promise.all(n)}}class mn{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(s,t){const n=this.parser.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class gn{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_CLEARCOAT}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:K}extendMaterialParams(s,t){const e=this.parser,n=e.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(e.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(e.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(e.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new P(a,a)}return Promise.all(i)}}class An{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_IRIDESCENCE}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:K}extendMaterialParams(s,t){const e=this.parser,n=e.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(e.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(e.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class Tn{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_SHEEN}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:K}extendMaterialParams(s,t){const e=this.parser,n=e.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new B(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(e.assignTexture(t,"sheenColorMap",o.sheenColorTexture,te)),o.sheenRoughnessTexture!==void 0&&i.push(e.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class bn{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_TRANSMISSION}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:K}extendMaterialParams(s,t){const e=this.parser,n=e.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(e.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class En{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_VOLUME}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:K}extendMaterialParams(s,t){const e=this.parser,n=e.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(e.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new B(a[0],a[1],a[2]),Promise.all(i)}}class yn{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_IOR}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:K}extendMaterialParams(s,t){const n=this.parser.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class xn{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_SPECULAR}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:K}extendMaterialParams(s,t){const e=this.parser,n=e.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(e.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new B(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&i.push(e.assignTexture(t,"specularColorMap",o.specularColorTexture,te)),Promise.all(i)}}class Rn{constructor(s){this.parser=s,this.name=L.KHR_MATERIALS_ANISOTROPY}getMaterialType(s){const e=this.parser.json.materials[s];return!e.extensions||!e.extensions[this.name]?null:K}extendMaterialParams(s,t){const e=this.parser,n=e.json.materials[s];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&i.push(e.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}}class Ln{constructor(s){this.parser=s,this.name=L.KHR_TEXTURE_BASISU}loadTexture(s){const t=this.parser,e=t.json,n=e.textures[s];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(s,i.source,o)}}class _n{constructor(s){this.parser=s,this.name=L.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(s){const t=this.name,e=this.parser,n=e.json,i=n.textures[s];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=n.images[o.source];let r=e.textureLoader;if(a.uri){const c=e.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return e.loadTextureImage(s,o.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return e.loadTexture(s)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(s){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){s(t.height===1)}})),this.isSupported}}class wn{constructor(s){this.parser=s,this.name=L.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(s){const t=this.name,e=this.parser,n=e.json,i=n.textures[s];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=n.images[o.source];let r=e.textureLoader;if(a.uri){const c=e.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return e.loadTextureImage(s,o.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return e.loadTexture(s)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(s){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){s(t.height===1)}})),this.isSupported}}class Mn{constructor(s){this.name=L.EXT_MESHOPT_COMPRESSION,this.parser=s}loadBufferView(s){const t=this.parser.json,e=t.bufferViews[s];if(e.extensions&&e.extensions[this.name]){const n=e.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){const r=n.byteOffset||0,c=n.byteLength||0,u=n.count,l=n.byteStride,f=new Uint8Array(a,r,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,l,f,n.mode,n.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(u*l);return o.decodeGltfBuffer(new Uint8Array(p),u,l,f,n.mode,n.filter),p})})}else return null}}class Sn{constructor(s){this.name=L.EXT_MESH_GPU_INSTANCING,this.parser=s}createNodeMesh(s){const t=this.parser.json,e=t.nodes[s];if(!e.extensions||!e.extensions[this.name]||e.mesh===void 0)return null;const n=t.meshes[e.mesh];for(const c of n.primitives)if(c.mode!==C.TRIANGLES&&c.mode!==C.TRIANGLE_STRIP&&c.mode!==C.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=e.extensions[this.name].attributes,a=[],r={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(r[c]=u,r[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(s)),Promise.all(a).then(c=>{const u=c.pop(),l=u.isGroup?u.children:[u],f=c[0].count,p=[];for(const m of l){const A=new ae,g=new M,T=new ce,b=new M(1,1,1),_=new Dt(m.geometry,m.material,f);for(let y=0;y<f;y++)r.TRANSLATION&&g.fromBufferAttribute(r.TRANSLATION,y),r.ROTATION&&T.fromBufferAttribute(r.ROTATION,y),r.SCALE&&b.fromBufferAttribute(r.SCALE,y),_.setMatrixAt(y,A.compose(g,T,b));for(const y in r)y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&m.geometry.setAttribute(y,r[y]);at.prototype.copy.call(_,m),this.parser.assignFinalMaterial(_),p.push(_)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}const ft="glTF",Q=12,We={JSON:1313821514,BIN:5130562};class Nn{constructor(s){this.name=L.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(s,0,Q),e=new TextDecoder;if(this.header={magic:e.decode(new Uint8Array(s.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ft)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Q,i=new DataView(s,Q);let o=0;for(;o<n;){const a=i.getUint32(o,!0);o+=4;const r=i.getUint32(o,!0);if(o+=4,r===We.JSON){const c=new Uint8Array(s,Q+o,a);this.content=e.decode(c)}else if(r===We.BIN){const c=Q+o;this.body=s.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class In{constructor(s,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=L.KHR_DRACO_MESH_COMPRESSION,this.json=s,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(s,t){const e=this.json,n=this.dracoLoader,i=s.extensions[this.name].bufferView,o=s.extensions[this.name].attributes,a={},r={},c={};for(const u in o){const l=_e[u]||u.toLowerCase();a[l]=o[u]}for(const u in s.attributes){const l=_e[u]||u.toLowerCase();if(o[u]!==void 0){const f=e.accessors[s.attributes[u]],p=W[f.componentType];c[l]=p.name,r[l]=f.normalized===!0}}return t.getDependency("bufferView",i).then(function(u){return new Promise(function(l){n.decodeDracoFile(u,function(f){for(const p in f.attributes){const m=f.attributes[p],A=r[p];A!==void 0&&(m.normalized=A)}l(f)},a,c)})})}}class On{constructor(){this.name=L.KHR_TEXTURE_TRANSFORM}extendTexture(s,t){return(t.texCoord===void 0||t.texCoord===s.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(s=s.clone(),t.texCoord!==void 0&&(s.channel=t.texCoord),t.offset!==void 0&&s.offset.fromArray(t.offset),t.rotation!==void 0&&(s.rotation=t.rotation),t.scale!==void 0&&s.repeat.fromArray(t.scale),s.needsUpdate=!0),s}}class Pn{constructor(){this.name=L.KHR_MESH_QUANTIZATION}}class dt extends rn{constructor(s,t,e,n){super(s,t,e,n)}copySampleValue_(s){const t=this.resultBuffer,e=this.sampleValues,n=this.valueSize,i=s*n*3+n;for(let o=0;o!==n;o++)t[o]=e[i+o];return t}interpolate_(s,t,e,n){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,r=a*2,c=a*3,u=n-t,l=(e-t)/u,f=l*l,p=f*l,m=s*c,A=m-c,g=-2*p+3*f,T=p-f,b=1-g,_=T-f+l;for(let y=0;y!==a;y++){const x=o[A+y+a],R=o[A+y+r]*u,w=o[m+y+a],j=o[m+y]*u;i[y]=b*x+_*R+g*w+T*j}return i}}const Cn=new ce;class Dn extends dt{interpolate_(s,t,e,n){const i=super.interpolate_(s,t,e,n);return Cn.fromArray(i).normalize().toArray(i),i}}const C={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},W={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ze={9728:Gt,9729:lt,9984:Ut,9985:Ht,9986:vt,9987:ct},Qe={33071:Kt,33648:Bt,10497:ye},pe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_e={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},U={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},jn={CUBICSPLINE:void 0,LINEAR:ht,STEP:tn},me={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Fn(d){return d.DefaultMaterial===void 0&&(d.DefaultMaterial=new ut({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:on})),d.DefaultMaterial}function V(d,s,t){for(const e in t.extensions)d[e]===void 0&&(s.userData.gltfExtensions=s.userData.gltfExtensions||{},s.userData.gltfExtensions[e]=t.extensions[e])}function G(d,s){s.extras!==void 0&&(typeof s.extras=="object"?Object.assign(d.userData,s.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+s.extras))}function kn(d,s,t){let e=!1,n=!1,i=!1;for(let c=0,u=s.length;c<u;c++){const l=s[c];if(l.POSITION!==void 0&&(e=!0),l.NORMAL!==void 0&&(n=!0),l.COLOR_0!==void 0&&(i=!0),e&&n&&i)break}if(!e&&!n&&!i)return Promise.resolve(d);const o=[],a=[],r=[];for(let c=0,u=s.length;c<u;c++){const l=s[c];if(e){const f=l.POSITION!==void 0?t.getDependency("accessor",l.POSITION):d.attributes.position;o.push(f)}if(n){const f=l.NORMAL!==void 0?t.getDependency("accessor",l.NORMAL):d.attributes.normal;a.push(f)}if(i){const f=l.COLOR_0!==void 0?t.getDependency("accessor",l.COLOR_0):d.attributes.color;r.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(r)]).then(function(c){const u=c[0],l=c[1],f=c[2];return e&&(d.morphAttributes.position=u),n&&(d.morphAttributes.normal=l),i&&(d.morphAttributes.color=f),d.morphTargetsRelative=!0,d})}function vn(d,s){if(d.updateMorphTargets(),s.weights!==void 0)for(let t=0,e=s.weights.length;t<e;t++)d.morphTargetInfluences[t]=s.weights[t];if(s.extras&&Array.isArray(s.extras.targetNames)){const t=s.extras.targetNames;if(d.morphTargetInfluences.length===t.length){d.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++)d.morphTargetDictionary[t[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Hn(d){let s;const t=d.extensions&&d.extensions[L.KHR_DRACO_MESH_COMPRESSION];if(t?s="draco:"+t.bufferView+":"+t.indices+":"+ge(t.attributes):s=d.indices+":"+ge(d.attributes)+":"+d.mode,d.targets!==void 0)for(let e=0,n=d.targets.length;e<n;e++)s+=":"+ge(d.targets[e]);return s}function ge(d){let s="";const t=Object.keys(d).sort();for(let e=0,n=t.length;e<n;e++)s+=t[e]+":"+d[t[e]]+";";return s}function we(d){switch(d){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Un(d){return d.search(/\.jpe?g($|\?)/i)>0||d.search(/^data\:image\/jpeg/)===0?"image/jpeg":d.search(/\.webp($|\?)/i)>0||d.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Gn=new ae;class Bn{constructor(s={},t={}){this.json=s,this.extensions={},this.plugins={},this.options=t,this.cache=new fn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let e=!1,n=!1,i=-1;typeof navigator<"u"&&(e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||e||n&&i<98?this.textureLoader=new jt(this.options.manager):this.textureLoader=new Ft(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Me(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(s){this.extensions=s}setPlugins(s){this.plugins=s}parse(s,t){const e=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([e.getDependencies("scene"),e.getDependencies("animation"),e.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:e,userData:{}};V(i,a,n),G(a,n),Promise.all(e._invokeAll(function(r){return r.afterRoot&&r.afterRoot(a)})).then(function(){s(a)})}).catch(t)}_markDefs(){const s=this.json.nodes||[],t=this.json.skins||[],e=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const o=t[n].joints;for(let a=0,r=o.length;a<r;a++)s[o[a]].isBone=!0}for(let n=0,i=s.length;n<i;n++){const o=s[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(e[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(s,t){t!==void 0&&(s.refs[t]===void 0&&(s.refs[t]=s.uses[t]=0),s.refs[t]++)}_getNodeRef(s,t,e){if(s.refs[t]<=1)return e;const n=e.clone(),i=(o,a)=>{const r=this.associations.get(o);r!=null&&this.associations.set(a,r);for(const[c,u]of o.children.entries())i(u,a.children[c])};return i(e,n),n.name+="_instance_"+s.uses[t]++,n}_invokeOne(s){const t=Object.values(this.plugins);t.push(this);for(let e=0;e<t.length;e++){const n=s(t[e]);if(n)return n}return null}_invokeAll(s){const t=Object.values(this.plugins);t.unshift(this);const e=[];for(let n=0;n<t.length;n++){const i=s(t[n]);i&&e.push(i)}return e}getDependency(s,t){const e=s+":"+t;let n=this.cache.get(e);if(!n){switch(s){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":n=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(s,t)}),!n)throw new Error("Unknown type: "+s);break}this.cache.add(e,n)}return n}getDependencies(s){let t=this.cache.get(s);if(!t){const e=this,n=this.json[s+(s==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(i,o){return e.getDependency(s,o)})),this.cache.add(s,t)}return t}loadBuffer(s){const t=this.json.buffers[s],e=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&s===0)return Promise.resolve(this.extensions[L.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(i,o){e.load(Ee.resolveURL(t.uri,n.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(s){const t=this.json.bufferViews[s];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)})}loadAccessor(s){const t=this,e=this.json,n=this.json.accessors[s];if(n.bufferView===void 0&&n.sparse===void 0){const o=pe[n.type],a=W[n.componentType],r=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new de(c,o,r))}const i=[];return n.bufferView!==void 0?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),n.sparse!==void 0&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(o){const a=o[0],r=pe[n.type],c=W[n.componentType],u=c.BYTES_PER_ELEMENT,l=u*r,f=n.byteOffset||0,p=n.bufferView!==void 0?e.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let A,g;if(p&&p!==l){const T=Math.floor(f/p),b="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+T+":"+n.count;let _=t.cache.get(b);_||(A=new c(a,T*p,n.count*p/u),_=new kt(A,p/u),t.cache.add(b,_)),g=new nn(_,r,f%p/u,m)}else a===null?A=new c(n.count*r):A=new c(a,f,n.count*r),g=new de(A,r,m);if(n.sparse!==void 0){const T=pe.SCALAR,b=W[n.sparse.indices.componentType],_=n.sparse.indices.byteOffset||0,y=n.sparse.values.byteOffset||0,x=new b(o[1],_,n.sparse.count*T),R=new c(o[2],y,n.sparse.count*r);a!==null&&(g=new de(g.array.slice(),g.itemSize,g.normalized));for(let w=0,j=x.length;w<j;w++){const I=x[w];if(g.setX(I,R[w*r]),r>=2&&g.setY(I,R[w*r+1]),r>=3&&g.setZ(I,R[w*r+2]),r>=4&&g.setW(I,R[w*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(s){const t=this.json,e=this.options,i=t.textures[s].source,o=t.images[i];let a=this.textureLoader;if(o.uri){const r=e.manager.getHandler(o.uri);r!==null&&(a=r)}return this.loadTextureImage(s,i,a)}loadTextureImage(s,t,e){const n=this,i=this.json,o=i.textures[s],a=i.images[t],r=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[r])return this.textureCache[r];const c=this.loadImageSource(t,e).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const f=(i.samplers||{})[o.sampler]||{};return u.magFilter=Ze[f.magFilter]||lt,u.minFilter=Ze[f.minFilter]||ct,u.wrapS=Qe[f.wrapS]||ye,u.wrapT=Qe[f.wrapT]||ye,n.associations.set(u,{textures:s}),u}).catch(function(){return null});return this.textureCache[r]=c,c}loadImageSource(s,t){const e=this,n=this.json,i=this.options;if(this.sourceCache[s]!==void 0)return this.sourceCache[s].then(l=>l.clone());const o=n.images[s],a=self.URL||self.webkitURL;let r=o.uri||"",c=!1;if(o.bufferView!==void 0)r=e.getDependency("bufferView",o.bufferView).then(function(l){c=!0;const f=new Blob([l],{type:o.mimeType});return r=a.createObjectURL(f),r});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+s+" is missing URI and bufferView");const u=Promise.resolve(r).then(function(l){return new Promise(function(f,p){let m=f;t.isImageBitmapLoader===!0&&(m=function(A){const g=new Ve(A);g.needsUpdate=!0,f(g)}),t.load(Ee.resolveURL(l,i.path),m,void 0,p)})}).then(function(l){return c===!0&&a.revokeObjectURL(r),l.userData.mimeType=o.mimeType||Un(o.uri),l}).catch(function(l){throw console.error("THREE.GLTFLoader: Couldn't load texture",r),l});return this.sourceCache[s]=u,u}assignTexture(s,t,e,n){const i=this;return this.getDependency("texture",e.index).then(function(o){if(!o)return null;if(e.texCoord!==void 0&&e.texCoord>0&&(o=o.clone(),o.channel=e.texCoord),i.extensions[L.KHR_TEXTURE_TRANSFORM]){const a=e.extensions!==void 0?e.extensions[L.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const r=i.associations.get(o);o=i.extensions[L.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),i.associations.set(o,r)}}return n!==void 0&&(o.colorSpace=n),s[t]=o,o})}assignFinalMaterial(s){const t=s.geometry;let e=s.material;const n=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(s.isPoints){const a="PointsMaterial:"+e.uuid;let r=this.cache.get(a);r||(r=new J,ee.prototype.copy.call(r,e),r.color.copy(e.color),r.map=e.map,r.sizeAttenuation=!1,this.cache.add(a,r)),e=r}else if(s.isLine){const a="LineBasicMaterial:"+e.uuid;let r=this.cache.get(a);r||(r=new ie,ee.prototype.copy.call(r,e),r.color.copy(e.color),r.map=e.map,this.cache.add(a,r)),e=r}if(n||i||o){let a="ClonedMaterial:"+e.uuid+":";n&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let r=this.cache.get(a);r||(r=e.clone(),i&&(r.vertexColors=!0),o&&(r.flatShading=!0),n&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(a,r),this.associations.set(r,this.associations.get(e))),e=r}s.material=e}getMaterialType(){return ut}loadMaterial(s){const t=this,e=this.json,n=this.extensions,i=e.materials[s];let o;const a={},r=i.extensions||{},c=[];if(r[L.KHR_MATERIALS_UNLIT]){const l=n[L.KHR_MATERIALS_UNLIT];o=l.getMaterialType(),c.push(l.extendParams(a,i,t))}else{const l=i.pbrMetallicRoughness||{};if(a.color=new B(1,1,1),a.opacity=1,Array.isArray(l.baseColorFactor)){const f=l.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}l.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",l.baseColorTexture,te)),a.metalness=l.metallicFactor!==void 0?l.metallicFactor:1,a.roughness=l.roughnessFactor!==void 0?l.roughnessFactor:1,l.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",l.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",l.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(s)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(s,a)})))}i.doubleSided===!0&&(a.side=Vt);const u=i.alphaMode||me.OPAQUE;if(u===me.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===me.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==$&&(c.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new P(1,1),i.normalTexture.scale!==void 0)){const l=i.normalTexture.scale;a.normalScale.set(l,l)}return i.occlusionTexture!==void 0&&o!==$&&(c.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==$&&(a.emissive=new B().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&o!==$&&c.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,te)),Promise.all(c).then(function(){const l=new o(a);return i.name&&(l.name=i.name),G(l,i),t.associations.set(l,{materials:s}),i.extensions&&V(n,l,i),l})}createUniqueName(s){const t=zt.sanitizeNodeName(s||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(s){const t=this,e=this.extensions,n=this.primitiveCache;function i(a){return e[L.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(r){return Je(r,a,t)})}const o=[];for(let a=0,r=s.length;a<r;a++){const c=s[a],u=Hn(c),l=n[u];if(l)o.push(l.promise);else{let f;c.extensions&&c.extensions[L.KHR_DRACO_MESH_COMPRESSION]?f=i(c):f=Je(new xe,c,t),n[u]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(s){const t=this,e=this.json,n=this.extensions,i=e.meshes[s],o=i.primitives,a=[];for(let r=0,c=o.length;r<c;r++){const u=o[r].material===void 0?Fn(this.cache):this.getDependency("material",o[r].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(r){const c=r.slice(0,r.length-1),u=r[r.length-1],l=[];for(let p=0,m=u.length;p<m;p++){const A=u[p],g=o[p];let T;const b=c[p];if(g.mode===C.TRIANGLES||g.mode===C.TRIANGLE_STRIP||g.mode===C.TRIANGLE_FAN||g.mode===void 0)T=i.isSkinnedMesh===!0?new Xt(A,b):new Re(A,b),T.isSkinnedMesh===!0&&T.normalizeSkinWeights(),g.mode===C.TRIANGLE_STRIP?T.geometry=qe(T.geometry,ot):g.mode===C.TRIANGLE_FAN&&(T.geometry=qe(T.geometry,be));else if(g.mode===C.LINES)T=new Le(A,b);else if(g.mode===C.LINE_STRIP)T=new Yt(A,b);else if(g.mode===C.LINE_LOOP)T=new qt(A,b);else if(g.mode===C.POINTS)T=new oe(A,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(T.geometry.morphAttributes).length>0&&vn(T,i),T.name=t.createUniqueName(i.name||"mesh_"+s),G(T,i),g.extensions&&V(n,T,g),t.assignFinalMaterial(T),l.push(T)}for(let p=0,m=l.length;p<m;p++)t.associations.set(l[p],{meshes:s,primitives:p});if(l.length===1)return i.extensions&&V(n,l[0],i),l[0];const f=new re;i.extensions&&V(n,f,i),t.associations.set(f,{meshes:s});for(let p=0,m=l.length;p<m;p++)f.add(l[p]);return f})}loadCamera(s){let t;const e=this.json.cameras[s],n=e[e.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return e.type==="perspective"?t=new Wt(Zt.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):e.type==="orthographic"&&(t=new Qt(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),e.name&&(t.name=this.createUniqueName(e.name)),G(t,e),Promise.resolve(t)}loadSkin(s){const t=this.json.skins[s],e=[];for(let n=0,i=t.joints.length;n<i;n++)e.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?e.push(this.getDependency("accessor",t.inverseBindMatrices)):e.push(null),Promise.all(e).then(function(n){const i=n.pop(),o=n,a=[],r=[];for(let c=0,u=o.length;c<u;c++){const l=o[c];if(l){a.push(l);const f=new ae;i!==null&&f.fromArray(i.array,c*16),r.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Jt(a,r)})}loadAnimation(s){const t=this.json,e=this,n=t.animations[s],i=n.name?n.name:"animation_"+s,o=[],a=[],r=[],c=[],u=[];for(let l=0,f=n.channels.length;l<f;l++){const p=n.channels[l],m=n.samplers[p.sampler],A=p.target,g=A.node,T=n.parameters!==void 0?n.parameters[m.input]:m.input,b=n.parameters!==void 0?n.parameters[m.output]:m.output;A.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",T)),r.push(this.getDependency("accessor",b)),c.push(m),u.push(A))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(r),Promise.all(c),Promise.all(u)]).then(function(l){const f=l[0],p=l[1],m=l[2],A=l[3],g=l[4],T=[];for(let b=0,_=f.length;b<_;b++){const y=f[b],x=p[b],R=m[b],w=A[b],j=g[b];if(y===void 0)continue;y.updateMatrix&&(y.updateMatrix(),y.matrixAutoUpdate=!0);const I=e._createAnimationTracks(y,x,R,w,j);if(I)for(let v=0;v<I.length;v++)T.push(I[v])}return new $t(i,void 0,T)})}createNodeMesh(s){const t=this.json,e=this,n=t.nodes[s];return n.mesh===void 0?null:e.getDependency("mesh",n.mesh).then(function(i){const o=e._getNodeRef(e.meshCache,n.mesh,i);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let r=0,c=n.weights.length;r<c;r++)a.morphTargetInfluences[r]=n.weights[r]}),o})}loadNode(s){const t=this.json,e=this,n=t.nodes[s],i=e._loadNodeShallow(s),o=[],a=n.children||[];for(let c=0,u=a.length;c<u;c++)o.push(e.getDependency("node",a[c]));const r=n.skin===void 0?Promise.resolve(null):e.getDependency("skin",n.skin);return Promise.all([i,Promise.all(o),r]).then(function(c){const u=c[0],l=c[1],f=c[2];f!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(f,Gn)});for(let p=0,m=l.length;p<m;p++)u.add(l[p]);return u})}_loadNodeShallow(s){const t=this.json,e=this.extensions,n=this;if(this.nodeCache[s]!==void 0)return this.nodeCache[s];const i=t.nodes[s],o=i.name?n.createUniqueName(i.name):"",a=[],r=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(s)});return r&&a.push(r),i.camera!==void 0&&a.push(n.getDependency("camera",i.camera).then(function(c){return n._getNodeRef(n.cameraCache,i.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(s)}).forEach(function(c){a.push(c)}),this.nodeCache[s]=Promise.all(a).then(function(c){let u;if(i.isBone===!0?u=new en:c.length>1?u=new re:c.length===1?u=c[0]:u=new at,u!==c[0])for(let l=0,f=c.length;l<f;l++)u.add(c[l]);if(i.name&&(u.userData.name=i.name,u.name=o),G(u,i),i.extensions&&V(e,u,i),i.matrix!==void 0){const l=new ae;l.fromArray(i.matrix),u.applyMatrix4(l)}else i.translation!==void 0&&u.position.fromArray(i.translation),i.rotation!==void 0&&u.quaternion.fromArray(i.rotation),i.scale!==void 0&&u.scale.fromArray(i.scale);return n.associations.has(u)||n.associations.set(u,{}),n.associations.get(u).nodes=s,u}),this.nodeCache[s]}loadScene(s){const t=this.extensions,e=this.json.scenes[s],n=this,i=new re;e.name&&(i.name=n.createUniqueName(e.name)),G(i,e),e.extensions&&V(t,i,e);const o=e.nodes||[],a=[];for(let r=0,c=o.length;r<c;r++)a.push(n.getDependency("node",o[r]));return Promise.all(a).then(function(r){for(let u=0,l=r.length;u<l;u++)i.add(r[u]);const c=u=>{const l=new Map;for(const[f,p]of n.associations)(f instanceof ee||f instanceof Ve)&&l.set(f,p);return u.traverse(f=>{const p=n.associations.get(f);p!=null&&l.set(f,p)}),l};return n.associations=c(i),i})}_createAnimationTracks(s,t,e,n,i){const o=[],a=s.name?s.name:s.uuid,r=[];U[i.path]===U.weights?s.traverse(function(f){f.morphTargetInfluences&&r.push(f.name?f.name:f.uuid)}):r.push(a);let c;switch(U[i.path]){case U.weights:c=ze;break;case U.rotation:c=Xe;break;case U.position:case U.scale:default:switch(e.itemSize){case 1:c=ze;break;case 2:case 3:c=sn;break}break}const u=n.interpolation!==void 0?jn[n.interpolation]:ht,l=this._getArrayFromAccessor(e);for(let f=0,p=r.length;f<p;f++){const m=new c(r[f]+"."+U[i.path],t.array,l,u);u==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(s){let t=s.array;if(s.normalized){const e=we(t.constructor),n=new Float32Array(t.length);for(let i=0,o=t.length;i<o;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(s){s.createInterpolant=function(e){const n=this instanceof Xe?Dn:dt;return new n(this.times,this.values,this.getValueSize()/3,e)},s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Kn(d,s,t){const e=s.attributes,n=new an;if(e.POSITION!==void 0){const a=t.json.accessors[e.POSITION],r=a.min,c=a.max;if(r!==void 0&&c!==void 0){if(n.set(new M(r[0],r[1],r[2]),new M(c[0],c[1],c[2])),a.normalized){const u=we(W[a.componentType]);n.min.multiplyScalar(u),n.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=s.targets;if(i!==void 0){const a=new M,r=new M;for(let c=0,u=i.length;c<u;c++){const l=i[c];if(l.POSITION!==void 0){const f=t.json.accessors[l.POSITION],p=f.min,m=f.max;if(p!==void 0&&m!==void 0){if(r.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),r.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),r.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),f.normalized){const A=we(W[f.componentType]);r.multiplyScalar(A)}a.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}d.boundingBox=n;const o=new cn;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,d.boundingSphere=o}function Je(d,s,t){const e=s.attributes,n=[];function i(o,a){return t.getDependency("accessor",o).then(function(r){d.setAttribute(a,r)})}for(const o in e){const a=_e[o]||o.toLowerCase();a in d.attributes||n.push(i(e[o],a))}if(s.indices!==void 0&&!d.index){const o=t.getDependency("accessor",s.indices).then(function(a){d.setIndex(a)});n.push(o)}return G(d,s),Kn(d,s,t),Promise.all(n).then(function(){return s.targets!==void 0?kn(d,s.targets,t):d})}const $n=Object.freeze(Object.defineProperty({__proto__:null,GLTFLoader:hn},Symbol.toStringTag,{value:"Module"})),$e={type:"change"},Ae={type:"start"},et={type:"end"};class Vn extends ln{constructor(s,t){super(),this.object=s,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new M,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:X.ROTATE,MIDDLE:X.DOLLY,RIGHT:X.PAN},this.touches={ONE:Y.ROTATE,TWO:Y.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(h){h.addEventListener("keydown",he),this._domElementKeyEvents=h},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",he),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent($e),e.update(),i=n.NONE},this.update=function(){const h=new M,E=new ce().setFromUnitVectors(s.up,new M(0,1,0)),S=E.clone().invert(),N=new M,D=new ce,ne=new M,H=2*Math.PI;return function(){const Ke=e.object.position;h.copy(Ke).sub(e.target),h.applyQuaternion(E),a.setFromVector3(h),e.autoRotate&&i===n.NONE&&I(w()),e.enableDamping?(a.theta+=r.theta*e.dampingFactor,a.phi+=r.phi*e.dampingFactor):(a.theta+=r.theta,a.phi+=r.phi);let F=e.minAzimuthAngle,k=e.maxAzimuthAngle;return isFinite(F)&&isFinite(k)&&(F<-Math.PI?F+=H:F>Math.PI&&(F-=H),k<-Math.PI?k+=H:k>Math.PI&&(k-=H),F<=k?a.theta=Math.max(F,Math.min(k,a.theta)):a.theta=a.theta>(F+k)/2?Math.max(F,a.theta):Math.min(k,a.theta)),a.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(e.minDistance,Math.min(e.maxDistance,a.radius)),e.enableDamping===!0?e.target.addScaledVector(u,e.dampingFactor):e.target.add(u),h.setFromSpherical(a),h.applyQuaternion(S),Ke.copy(e.target).add(h),e.object.lookAt(e.target),e.enableDamping===!0?(r.theta*=1-e.dampingFactor,r.phi*=1-e.dampingFactor,u.multiplyScalar(1-e.dampingFactor)):(r.set(0,0,0),u.set(0,0,0)),c=1,l||N.distanceToSquared(e.object.position)>o||8*(1-D.dot(e.object.quaternion))>o||ne.distanceToSquared(e.target)>0?(e.dispatchEvent($e),N.copy(e.object.position),D.copy(e.object.quaternion),ne.copy(e.target),l=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",Ge),e.domElement.removeEventListener("pointerdown",He),e.domElement.removeEventListener("pointercancel",Z),e.domElement.removeEventListener("wheel",Ue),e.domElement.removeEventListener("pointermove",ue),e.domElement.removeEventListener("pointerup",Z),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",he),e._domElementKeyEvents=null)};const e=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=n.NONE;const o=1e-6,a=new Ye,r=new Ye;let c=1;const u=new M;let l=!1;const f=new P,p=new P,m=new P,A=new P,g=new P,T=new P,b=new P,_=new P,y=new P,x=[],R={};function w(){return 2*Math.PI/60/60*e.autoRotateSpeed}function j(){return Math.pow(.95,e.zoomSpeed)}function I(h){r.theta-=h}function v(h){r.phi-=h}const Se=function(){const h=new M;return function(S,N){h.setFromMatrixColumn(N,0),h.multiplyScalar(-S),u.add(h)}}(),Ne=function(){const h=new M;return function(S,N){e.screenSpacePanning===!0?h.setFromMatrixColumn(N,1):(h.setFromMatrixColumn(N,0),h.crossVectors(e.object.up,h)),h.multiplyScalar(S),u.add(h)}}(),z=function(){const h=new M;return function(S,N){const D=e.domElement;if(e.object.isPerspectiveCamera){const ne=e.object.position;h.copy(ne).sub(e.target);let H=h.length();H*=Math.tan(e.object.fov/2*Math.PI/180),Se(2*S*H/D.clientHeight,e.object.matrix),Ne(2*N*H/D.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(Se(S*(e.object.right-e.object.left)/e.object.zoom/D.clientWidth,e.object.matrix),Ne(N*(e.object.top-e.object.bottom)/e.object.zoom/D.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function le(h){e.object.isPerspectiveCamera?c/=h:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*h)),e.object.updateProjectionMatrix(),l=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ie(h){e.object.isPerspectiveCamera?c*=h:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),l=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Oe(h){f.set(h.clientX,h.clientY)}function pt(h){b.set(h.clientX,h.clientY)}function Pe(h){A.set(h.clientX,h.clientY)}function mt(h){p.set(h.clientX,h.clientY),m.subVectors(p,f).multiplyScalar(e.rotateSpeed);const E=e.domElement;I(2*Math.PI*m.x/E.clientHeight),v(2*Math.PI*m.y/E.clientHeight),f.copy(p),e.update()}function gt(h){_.set(h.clientX,h.clientY),y.subVectors(_,b),y.y>0?le(j()):y.y<0&&Ie(j()),b.copy(_),e.update()}function At(h){g.set(h.clientX,h.clientY),T.subVectors(g,A).multiplyScalar(e.panSpeed),z(T.x,T.y),A.copy(g),e.update()}function Tt(h){h.deltaY<0?Ie(j()):h.deltaY>0&&le(j()),e.update()}function bt(h){let E=!1;switch(h.code){case e.keys.UP:h.ctrlKey||h.metaKey||h.shiftKey?v(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):z(0,e.keyPanSpeed),E=!0;break;case e.keys.BOTTOM:h.ctrlKey||h.metaKey||h.shiftKey?v(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):z(0,-e.keyPanSpeed),E=!0;break;case e.keys.LEFT:h.ctrlKey||h.metaKey||h.shiftKey?I(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):z(e.keyPanSpeed,0),E=!0;break;case e.keys.RIGHT:h.ctrlKey||h.metaKey||h.shiftKey?I(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):z(-e.keyPanSpeed,0),E=!0;break}E&&(h.preventDefault(),e.update())}function Ce(){if(x.length===1)f.set(x[0].pageX,x[0].pageY);else{const h=.5*(x[0].pageX+x[1].pageX),E=.5*(x[0].pageY+x[1].pageY);f.set(h,E)}}function De(){if(x.length===1)A.set(x[0].pageX,x[0].pageY);else{const h=.5*(x[0].pageX+x[1].pageX),E=.5*(x[0].pageY+x[1].pageY);A.set(h,E)}}function je(){const h=x[0].pageX-x[1].pageX,E=x[0].pageY-x[1].pageY,S=Math.sqrt(h*h+E*E);b.set(0,S)}function Et(){e.enableZoom&&je(),e.enablePan&&De()}function yt(){e.enableZoom&&je(),e.enableRotate&&Ce()}function Fe(h){if(x.length==1)p.set(h.pageX,h.pageY);else{const S=fe(h),N=.5*(h.pageX+S.x),D=.5*(h.pageY+S.y);p.set(N,D)}m.subVectors(p,f).multiplyScalar(e.rotateSpeed);const E=e.domElement;I(2*Math.PI*m.x/E.clientHeight),v(2*Math.PI*m.y/E.clientHeight),f.copy(p)}function ke(h){if(x.length===1)g.set(h.pageX,h.pageY);else{const E=fe(h),S=.5*(h.pageX+E.x),N=.5*(h.pageY+E.y);g.set(S,N)}T.subVectors(g,A).multiplyScalar(e.panSpeed),z(T.x,T.y),A.copy(g)}function ve(h){const E=fe(h),S=h.pageX-E.x,N=h.pageY-E.y,D=Math.sqrt(S*S+N*N);_.set(0,D),y.set(0,Math.pow(_.y/b.y,e.zoomSpeed)),le(y.y),b.copy(_)}function xt(h){e.enableZoom&&ve(h),e.enablePan&&ke(h)}function Rt(h){e.enableZoom&&ve(h),e.enableRotate&&Fe(h)}function He(h){e.enabled!==!1&&(x.length===0&&(e.domElement.setPointerCapture(h.pointerId),e.domElement.addEventListener("pointermove",ue),e.domElement.addEventListener("pointerup",Z)),St(h),h.pointerType==="touch"?wt(h):Lt(h))}function ue(h){e.enabled!==!1&&(h.pointerType==="touch"?Mt(h):_t(h))}function Z(h){Nt(h),x.length===0&&(e.domElement.releasePointerCapture(h.pointerId),e.domElement.removeEventListener("pointermove",ue),e.domElement.removeEventListener("pointerup",Z)),e.dispatchEvent(et),i=n.NONE}function Lt(h){let E;switch(h.button){case 0:E=e.mouseButtons.LEFT;break;case 1:E=e.mouseButtons.MIDDLE;break;case 2:E=e.mouseButtons.RIGHT;break;default:E=-1}switch(E){case X.DOLLY:if(e.enableZoom===!1)return;pt(h),i=n.DOLLY;break;case X.ROTATE:if(h.ctrlKey||h.metaKey||h.shiftKey){if(e.enablePan===!1)return;Pe(h),i=n.PAN}else{if(e.enableRotate===!1)return;Oe(h),i=n.ROTATE}break;case X.PAN:if(h.ctrlKey||h.metaKey||h.shiftKey){if(e.enableRotate===!1)return;Oe(h),i=n.ROTATE}else{if(e.enablePan===!1)return;Pe(h),i=n.PAN}break;default:i=n.NONE}i!==n.NONE&&e.dispatchEvent(Ae)}function _t(h){switch(i){case n.ROTATE:if(e.enableRotate===!1)return;mt(h);break;case n.DOLLY:if(e.enableZoom===!1)return;gt(h);break;case n.PAN:if(e.enablePan===!1)return;At(h);break}}function Ue(h){e.enabled===!1||e.enableZoom===!1||i!==n.NONE||(h.preventDefault(),e.dispatchEvent(Ae),Tt(h),e.dispatchEvent(et))}function he(h){e.enabled===!1||e.enablePan===!1||bt(h)}function wt(h){switch(Be(h),x.length){case 1:switch(e.touches.ONE){case Y.ROTATE:if(e.enableRotate===!1)return;Ce(),i=n.TOUCH_ROTATE;break;case Y.PAN:if(e.enablePan===!1)return;De(),i=n.TOUCH_PAN;break;default:i=n.NONE}break;case 2:switch(e.touches.TWO){case Y.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Et(),i=n.TOUCH_DOLLY_PAN;break;case Y.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;yt(),i=n.TOUCH_DOLLY_ROTATE;break;default:i=n.NONE}break;default:i=n.NONE}i!==n.NONE&&e.dispatchEvent(Ae)}function Mt(h){switch(Be(h),i){case n.TOUCH_ROTATE:if(e.enableRotate===!1)return;Fe(h),e.update();break;case n.TOUCH_PAN:if(e.enablePan===!1)return;ke(h),e.update();break;case n.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;xt(h),e.update();break;case n.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Rt(h),e.update();break;default:i=n.NONE}}function Ge(h){e.enabled!==!1&&h.preventDefault()}function St(h){x.push(h)}function Nt(h){delete R[h.pointerId];for(let E=0;E<x.length;E++)if(x[E].pointerId==h.pointerId){x.splice(E,1);return}}function Be(h){let E=R[h.pointerId];E===void 0&&(E=new P,R[h.pointerId]=E),E.set(h.pageX,h.pageY)}function fe(h){const E=h.pointerId===x[0].pointerId?x[1]:x[0];return R[E.pointerId]}e.domElement.addEventListener("contextmenu",Ge),e.domElement.addEventListener("pointerdown",He),e.domElement.addEventListener("pointercancel",Z),e.domElement.addEventListener("wheel",Ue,{passive:!1}),this.update()}}const es=Object.freeze(Object.defineProperty({__proto__:null,OrbitControls:Vn},Symbol.toStringTag,{value:"Module"})),zn=/^[og]\s*(.+)?/,Xn=/^mtllib /,Yn=/^usemtl /,qn=/^usemap /,tt=/\s+/,nt=new M,Te=new M,st=new M,it=new M,O=new M,se=new B;function Wn(){const d={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(s,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=s,this.object.fromDeclaration=t!==!1;return}const e=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:s||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(n,i){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:n||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(r){const c={index:typeof r=="number"?r:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(n){const i=this.currentMaterial();if(i&&i.groupEnd===-1&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),n&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return n&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),i}},e&&e.name&&typeof e.clone=="function"){const n=e.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(s,t){const e=parseInt(s,10);return(e>=0?e-1:e+t/3)*3},parseNormalIndex:function(s,t){const e=parseInt(s,10);return(e>=0?e-1:e+t/3)*3},parseUVIndex:function(s,t){const e=parseInt(s,10);return(e>=0?e-1:e+t/2)*2},addVertex:function(s,t,e){const n=this.vertices,i=this.object.geometry.vertices;i.push(n[s+0],n[s+1],n[s+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2])},addVertexPoint:function(s){const t=this.vertices;this.object.geometry.vertices.push(t[s+0],t[s+1],t[s+2])},addVertexLine:function(s){const t=this.vertices;this.object.geometry.vertices.push(t[s+0],t[s+1],t[s+2])},addNormal:function(s,t,e){const n=this.normals,i=this.object.geometry.normals;i.push(n[s+0],n[s+1],n[s+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2])},addFaceNormal:function(s,t,e){const n=this.vertices,i=this.object.geometry.normals;nt.fromArray(n,s),Te.fromArray(n,t),st.fromArray(n,e),O.subVectors(st,Te),it.subVectors(nt,Te),O.cross(it),O.normalize(),i.push(O.x,O.y,O.z),i.push(O.x,O.y,O.z),i.push(O.x,O.y,O.z)},addColor:function(s,t,e){const n=this.colors,i=this.object.geometry.colors;n[s]!==void 0&&i.push(n[s+0],n[s+1],n[s+2]),n[t]!==void 0&&i.push(n[t+0],n[t+1],n[t+2]),n[e]!==void 0&&i.push(n[e+0],n[e+1],n[e+2])},addUV:function(s,t,e){const n=this.uvs,i=this.object.geometry.uvs;i.push(n[s+0],n[s+1]),i.push(n[t+0],n[t+1]),i.push(n[e+0],n[e+1])},addDefaultUV:function(){const s=this.object.geometry.uvs;s.push(0,0),s.push(0,0),s.push(0,0)},addUVLine:function(s){const t=this.uvs;this.object.geometry.uvs.push(t[s+0],t[s+1])},addFace:function(s,t,e,n,i,o,a,r,c){const u=this.vertices.length;let l=this.parseVertexIndex(s,u),f=this.parseVertexIndex(t,u),p=this.parseVertexIndex(e,u);if(this.addVertex(l,f,p),this.addColor(l,f,p),a!==void 0&&a!==""){const m=this.normals.length;l=this.parseNormalIndex(a,m),f=this.parseNormalIndex(r,m),p=this.parseNormalIndex(c,m),this.addNormal(l,f,p)}else this.addFaceNormal(l,f,p);if(n!==void 0&&n!==""){const m=this.uvs.length;l=this.parseUVIndex(n,m),f=this.parseUVIndex(i,m),p=this.parseUVIndex(o,m),this.addUV(l,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(s){this.object.geometry.type="Points";const t=this.vertices.length;for(let e=0,n=s.length;e<n;e++){const i=this.parseVertexIndex(s[e],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(s,t){this.object.geometry.type="Line";const e=this.vertices.length,n=this.uvs.length;for(let i=0,o=s.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(s[i],e));for(let i=0,o=t.length;i<o;i++)this.addUVLine(this.parseUVIndex(t[i],n))}};return d.startObject("",!1),d}class Zn extends rt{constructor(s){super(s),this.materials=null}load(s,t,e,n){const i=this,o=new Me(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(s,function(a){try{t(i.parse(a))}catch(r){n?n(r):console.error(r),i.manager.itemError(s)}},e,n)}setMaterials(s){return this.materials=s,this}parse(s){const t=new Wn;s.indexOf(`\r
`)!==-1&&(s=s.replace(/\r\n/g,`
`)),s.indexOf(`\\
`)!==-1&&(s=s.replace(/\\\n/g,""));const e=s.split(`
`);let n=[];for(let a=0,r=e.length;a<r;a++){const c=e[a].trimStart();if(c.length===0)continue;const u=c.charAt(0);if(u!=="#")if(u==="v"){const l=c.split(tt);switch(l[0]){case"v":t.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),l.length>=7?(se.setRGB(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6])).convertSRGBToLinear(),t.colors.push(se.r,se.g,se.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":t.uvs.push(parseFloat(l[1]),parseFloat(l[2]));break}}else if(u==="f"){const f=c.slice(1).trim().split(tt),p=[];for(let A=0,g=f.length;A<g;A++){const T=f[A];if(T.length>0){const b=T.split("/");p.push(b)}}const m=p[0];for(let A=1,g=p.length-1;A<g;A++){const T=p[A],b=p[A+1];t.addFace(m[0],T[0],b[0],m[1],T[1],b[1],m[2],T[2],b[2])}}else if(u==="l"){const l=c.substring(1).trim().split(" ");let f=[];const p=[];if(c.indexOf("/")===-1)f=l;else for(let m=0,A=l.length;m<A;m++){const g=l[m].split("/");g[0]!==""&&f.push(g[0]),g[1]!==""&&p.push(g[1])}t.addLineGeometry(f,p)}else if(u==="p"){const f=c.slice(1).trim().split(" ");t.addPointGeometry(f)}else if((n=zn.exec(c))!==null){const l=(" "+n[0].slice(1).trim()).slice(1);t.startObject(l)}else if(Yn.test(c))t.object.startMaterial(c.substring(7).trim(),t.materialLibraries);else if(Xn.test(c))t.materialLibraries.push(c.substring(7).trim());else if(qn.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(u==="s"){if(n=c.split(" "),n.length>1){const f=n[1].trim().toLowerCase();t.object.smooth=f!=="0"&&f!=="off"}else t.object.smooth=!0;const l=t.object.currentMaterial();l&&(l.smooth=t.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}t.finalize();const i=new re;if(i.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,r=t.objects.length;a<r;a++){const c=t.objects[a],u=c.geometry,l=c.materials,f=u.type==="Line",p=u.type==="Points";let m=!1;if(u.vertices.length===0)continue;const A=new xe;A.setAttribute("position",new q(u.vertices,3)),u.normals.length>0&&A.setAttribute("normal",new q(u.normals,3)),u.colors.length>0&&(m=!0,A.setAttribute("color",new q(u.colors,3))),u.hasUVIndices===!0&&A.setAttribute("uv",new q(u.uvs,2));const g=[];for(let b=0,_=l.length;b<_;b++){const y=l[b],x=y.name+"_"+y.smooth+"_"+m;let R=t.materials[x];if(this.materials!==null){if(R=this.materials.create(y.name),f&&R&&!(R instanceof ie)){const w=new ie;ee.prototype.copy.call(w,R),w.color.copy(R.color),R=w}else if(p&&R&&!(R instanceof J)){const w=new J({size:10,sizeAttenuation:!1});ee.prototype.copy.call(w,R),w.color.copy(R.color),w.map=R.map,R=w}}R===void 0&&(f?R=new ie:p?R=new J({size:1,sizeAttenuation:!1}):R=new un,R.name=y.name,R.flatShading=!y.smooth,R.vertexColors=m,t.materials[x]=R),g.push(R)}let T;if(g.length>1){for(let b=0,_=l.length;b<_;b++){const y=l[b];A.addGroup(y.groupStart,y.groupCount,b)}f?T=new Le(A,g):p?T=new oe(A,g):T=new Re(A,g)}else f?T=new Le(A,g[0]):p?T=new oe(A,g[0]):T=new Re(A,g[0]);T.name=c.name,i.add(T)}else if(t.vertices.length>0){const a=new J({size:1,sizeAttenuation:!1}),r=new xe;r.setAttribute("position",new q(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(r.setAttribute("color",new q(t.colors,3)),a.vertexColors=!0);const c=new oe(r,a);i.add(c)}return i}}const ts=Object.freeze(Object.defineProperty({__proto__:null,OBJLoader:Zn},Symbol.toStringTag,{value:"Module"}));export{$n as G,es as O,ts as a};
